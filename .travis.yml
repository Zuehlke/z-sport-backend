language: java
services:
  - docker
env:
  global:
  - PATH=$PATH:$HOME/google-cloud-sdk/bin
  - PROJECT_ID="z-sport-frontend-test"
  - ZONE="europe-west1-b"
  - IMAGE_NAME=z-sport-backend:latest
  - FULL_IMAGE_NAME=zuehlke.com/z-sport/$IMAGE_NAME
  - GOOGLE_APPLICATION_CREDENTIALS="client-secret.json"
  - CLUSTER_NAME=z-sport-backend-cluster
jdk:
  - oraclejdk11
before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
  - $HOME/.gradle/caches/
  - $HOME/.gradle/wrapper/
install:
  - ./gradlew check
jobs:
  include:
  # TODO: re enable this - currently not running to reduce build time
  - stage: "Unit Tests"
    script:
      - ./gradlew test
   - stage: "Deploy to GCP"
    script:
      - curl https://Sid.cloud.google.com | bash
      #- source /home/travis/.bashrc
      #- ./gcloud-sdk-configure.sh
#before_install:
  #- openssl aes-256-cbc -K $encrypted_4ca53e5fef4b_key -iv $encrypted_4ca53e5fef4b_iv -in credentials.tar.gz.enc -out credentials.tar.gz -d
  #- tar xvf credentials.tar.gz


